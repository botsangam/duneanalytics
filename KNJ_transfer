SELECT
  DATE_TRUNC('day', evt_block_time) AS date,
  "from",
  "to",
  ROUND(amount, 2) AS amount
FROM (
  SELECT
    evt_block_time,
    "from",
    "to",
    SUM(amount) / POWER(10, 18) AS amount
  FROM (
    SELECT
      evt_block_time,
      TRY_CAST(value AS DOUBLE) AS amount,
      "to" AS "from",
      "from" AS "to"
    FROM erc20_arbitrum.evt_Transfer
    WHERE
      contract_address = 0xfbbb21d8e7A461f06e5E27efD69703aCB5C732A8
      AND evt_block_time >= CURRENT_TIMESTAMP - INTERVAL '7' day
    UNION ALL
    SELECT
      evt_block_time,
      (
        -1
      ) * TRY_CAST(value AS DOUBLE) AS amount,
      "from",
      "to"
    FROM erc20_arbitrum.evt_Transfer
    WHERE
      contract_address = 0xfbbb21d8e7A461f06e5E27efD69703aCB5C732A8
      AND evt_block_time >= CURRENT_TIMESTAMP - INTERVAL '7' day
  ) AS x
  GROUP BY
    1,
    2,
    3
) AS y
WHERE
  amount > 2
ORDER BY
  date DESC
